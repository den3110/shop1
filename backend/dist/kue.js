"use strict";

var _interopRequireDefault = require("@babel/runtime/helpers/interopRequireDefault");
Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.queue = exports["default"] = void 0;
var _kue = _interopRequireDefault(require("kue"));
var _models = require("./models");
var _config = _interopRequireDefault(require("./config"));
var queue = exports.queue = _kue["default"].createQueue({
  prefix: 'q',
  redis: {
    host: _config["default"].redis.host,
    port: _config["default"].redis.port,
    auth: _config["default"].redis.password
  }
});
var _default = exports["default"] = {
  init: function init() {
    queue.process('img-upload', function (job, done) {
      Promise.all([_models.db.productphoto.bulkCreate(job.data.attachmentEntries), _models.db.productphoto.destroy({
        where: {
          id: job.data.productId
        }
      })]).then(function (r) {
        done(true);
      })["catch"](function (err) {
        console.log('error - ' + err);
        done(false);
      });
    });
  }
};
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJfa3VlIiwiX2ludGVyb3BSZXF1aXJlRGVmYXVsdCIsInJlcXVpcmUiLCJfbW9kZWxzIiwiX2NvbmZpZyIsInF1ZXVlIiwiZXhwb3J0cyIsImt1ZSIsImNyZWF0ZVF1ZXVlIiwicHJlZml4IiwicmVkaXMiLCJob3N0IiwiY29uZmlnIiwicG9ydCIsImF1dGgiLCJwYXNzd29yZCIsIl9kZWZhdWx0IiwiaW5pdCIsInByb2Nlc3MiLCJqb2IiLCJkb25lIiwiUHJvbWlzZSIsImFsbCIsImRiIiwicHJvZHVjdHBob3RvIiwiYnVsa0NyZWF0ZSIsImRhdGEiLCJhdHRhY2htZW50RW50cmllcyIsImRlc3Ryb3kiLCJ3aGVyZSIsImlkIiwicHJvZHVjdElkIiwidGhlbiIsInIiLCJlcnIiLCJjb25zb2xlIiwibG9nIl0sInNvdXJjZXMiOlsiLi4vc3JjL2t1ZS5qcyJdLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQga3VlIGZyb20gJ2t1ZSc7XHJcbmltcG9ydCB7IGRiIH0gZnJvbSAnLi9tb2RlbHMnO1xyXG5pbXBvcnQgY29uZmlnIGZyb20gJy4vY29uZmlnJztcclxuXHJcbmV4cG9ydCB2YXIgcXVldWUgPSBrdWUuY3JlYXRlUXVldWUoe1xyXG4gICAgcHJlZml4OiAncScsXHJcbiAgICByZWRpczoge1xyXG4gICAgICAgIGhvc3Q6IGNvbmZpZy5yZWRpcy5ob3N0LFxyXG4gICAgICAgIHBvcnQ6IGNvbmZpZy5yZWRpcy5wb3J0LFxyXG4gICAgICAgIGF1dGg6IGNvbmZpZy5yZWRpcy5wYXNzd29yZFxyXG4gICAgfVxyXG59KTtcclxuXHJcbmV4cG9ydCBkZWZhdWx0IHtcclxuICAgIGluaXQ6ICgpID0+IHtcclxuICAgICAgICBxdWV1ZS5wcm9jZXNzKCdpbWctdXBsb2FkJywgZnVuY3Rpb24gKGpvYiwgZG9uZSkge1xyXG4gICAgICAgICAgICBQcm9taXNlLmFsbChbXHJcbiAgICAgICAgICAgICAgICBkYi5wcm9kdWN0cGhvdG8uYnVsa0NyZWF0ZShqb2IuZGF0YS5hdHRhY2htZW50RW50cmllcyksXHJcbiAgICAgICAgICAgICAgICBkYi5wcm9kdWN0cGhvdG8uZGVzdHJveSh7XHJcbiAgICAgICAgICAgICAgICAgICAgd2hlcmU6IHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWQ6IGpvYi5kYXRhLnByb2R1Y3RJZFxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIF0pXHJcbiAgICAgICAgICAgIC50aGVuKHIgPT4ge1xyXG4gICAgICAgICAgICAgICAgZG9uZSh0cnVlKTtcclxuICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgLmNhdGNoKGVyciA9PiB7XHJcbiAgICAgICAgICAgICAgICBjb25zb2xlLmxvZygnZXJyb3IgLSAnICsgZXJyKTtcclxuICAgICAgICAgICAgICAgIGRvbmUoZmFsc2UpO1xyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgIH1cclxuXHJcbn0iXSwibWFwcGluZ3MiOiI7Ozs7Ozs7QUFBQSxJQUFBQSxJQUFBLEdBQUFDLHNCQUFBLENBQUFDLE9BQUE7QUFDQSxJQUFBQyxPQUFBLEdBQUFELE9BQUE7QUFDQSxJQUFBRSxPQUFBLEdBQUFILHNCQUFBLENBQUFDLE9BQUE7QUFFTyxJQUFJRyxLQUFLLEdBQUFDLE9BQUEsQ0FBQUQsS0FBQSxHQUFHRSxlQUFHLENBQUNDLFdBQVcsQ0FBQztFQUMvQkMsTUFBTSxFQUFFLEdBQUc7RUFDWEMsS0FBSyxFQUFFO0lBQ0hDLElBQUksRUFBRUMsa0JBQU0sQ0FBQ0YsS0FBSyxDQUFDQyxJQUFJO0lBQ3ZCRSxJQUFJLEVBQUVELGtCQUFNLENBQUNGLEtBQUssQ0FBQ0csSUFBSTtJQUN2QkMsSUFBSSxFQUFFRixrQkFBTSxDQUFDRixLQUFLLENBQUNLO0VBQ3ZCO0FBQ0osQ0FBQyxDQUFDO0FBQUMsSUFBQUMsUUFBQSxHQUFBVixPQUFBLGNBRVk7RUFDWFcsSUFBSSxFQUFFLFNBQUFBLEtBQUEsRUFBTTtJQUNSWixLQUFLLENBQUNhLE9BQU8sQ0FBQyxZQUFZLEVBQUUsVUFBVUMsR0FBRyxFQUFFQyxJQUFJLEVBQUU7TUFDN0NDLE9BQU8sQ0FBQ0MsR0FBRyxDQUFDLENBQ1JDLFVBQUUsQ0FBQ0MsWUFBWSxDQUFDQyxVQUFVLENBQUNOLEdBQUcsQ0FBQ08sSUFBSSxDQUFDQyxpQkFBaUIsQ0FBQyxFQUN0REosVUFBRSxDQUFDQyxZQUFZLENBQUNJLE9BQU8sQ0FBQztRQUNwQkMsS0FBSyxFQUFFO1VBQ0hDLEVBQUUsRUFBRVgsR0FBRyxDQUFDTyxJQUFJLENBQUNLO1FBQ2pCO01BQ0osQ0FBQyxDQUFDLENBQ0wsQ0FBQyxDQUNEQyxJQUFJLENBQUMsVUFBQUMsQ0FBQyxFQUFJO1FBQ1BiLElBQUksQ0FBQyxJQUFJLENBQUM7TUFDZCxDQUFDLENBQUMsU0FDSSxDQUFDLFVBQUFjLEdBQUcsRUFBSTtRQUNWQyxPQUFPLENBQUNDLEdBQUcsQ0FBQyxVQUFVLEdBQUdGLEdBQUcsQ0FBQztRQUM3QmQsSUFBSSxDQUFDLEtBQUssQ0FBQztNQUNmLENBQUMsQ0FBQztJQUNOLENBQUMsQ0FBQztFQUVOO0FBRUosQ0FBQyIsImlnbm9yZUxpc3QiOltdfQ==